{
	'variables': {
		'conditions': [
			['OS != "win"', {
				'lp%': '<!(sh lp.sh)'
			}]
		]
	},
	'targets': [{
		'target_name': 'protobuf',
		'sources': [ './src/init.cpp', './src/native.cpp', './src/parse.cpp', './src/serialize.cpp' ],
		'include_dirs': [
			'<!(node -e "require(\'nan\')")',
			'/usr/local/protobuf/include'
		],
		'libraries': [
			'-L/usr/local/protobuf/lib'
		],
		'cflags' : [ '-Ofast', '-ffast-math', '-funroll-loops', '-fomit-frame-pointer', '-std=c++11', '-pthread', '-static', '-I../../' ],
		'cflags_cc' : [ '-Ofast', '-ffast-math', '-funroll-loops', '-fomit-frame-pointer', '-std=c++11', '-pthread', '-static', '-I../../' ],
		'conditions': [
			['OS == "win"', {
				'libraries': [
					'-llibprotobuf.lib'
				],
				'msvs_settings': {
					'VCLinkerTool': {
						'AdditionalLibraryDirectories': '<(LIBPROTOBUF)/lib'
					}
				}
			}],
			['OS == "mac"', {
				'libraries': [
					'-lprotobuf'
				],
				'xcode_settings': {
					'MACOSX_DEPLOYMENT_TARGET': '10.7',
					'OTHER_CPLUSPLUSFLAGS': [
						'-stdlib=libc++',
					],
					'GCC_ENABLE_CPP_RTTI': 'YES'
				}
			}],
			['OS == "linux"', {
				'cflags_cc!': [ '-fno-rtti' ],
				'libraries': [
					'-lprotobuf'
				]
			}]
		]
	}]
}
